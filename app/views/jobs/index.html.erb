<%= render 'layouts/navigations' %>
<p id="notice"><%= notice %></p>
<div class="container">
  <h2> Your Current Jobs</h2>

  <%# form_tag jobs_path, :method => 'get' do %>
      <%# text_field_tag :search, params[:search] %>
      <%# submit_tag "Search" %>
    <%# end %>

    <%# link_to "Advanced Search", new_search_path %>

  <table class="table-condensed">
    <thead>
      <tr>
        <th>Number</th>
        <th>Job type</th>
        <th>Description</th>
        <th>Position</th>
        <th>Location</th>
        <th>Status</th>
        <th>Day</th>
        <th>Amount</th>
        <th colspan="3"></th>
      </tr>
    </thead>

    <tbody>
      <% @jobs.each_with_index do |job,index| %>
        <tr>
          <td><%= index + 1 %></td>
          <td><%= job.job_type %></td>
          <td><%= link_to job, method: :get do %>
            <%= truncate(job.description, :length => 100, :omission => '... (continued)') %>
          <% end %></td>

          <td><%= job.position %></td>
          <td><%= job.location %></td>
          <td><%= job.status %></td>
          <td><%= job.day %></td>
          <td>$<%= job.day.to_i * 100 %></td>
          <td>
            <% if job.payment.nil? %>
              <%= form_tag transactions_path do  %>

              <%= hidden_field_tag 'job_id', job.id %>
              <script
                src="https://checkout.stripe.com/checkout.js" class="stripe-button"
                data-key="<%= Rails.configuration.stripe[:publishable_key] %>"
                data-amount="	<%= job.day.to_i * 100 * 100 %>"
                data-name=""
                data-description=""
                data-email="<%= current_user.email %>"
                data-locale="auto">
              </script>
              <% end %>
            <% else %>
            	<%= link_to 'Paid', job %></td>
            <% end %>
          </td>

          <td><%= link_to 'Edit', edit_job_path(job) %></td>
          <td><%= link_to 'Delete', job, method: :delete, data: { confirm: 'Are you sure?' } %></td>
        </tr>
      <% end %>
    </tbody>
  </table>

  <br>

  <%= link_to ' + New Job', new_job_path, class: 'btn btn-default btn-xs', method: :get %>
</div>
